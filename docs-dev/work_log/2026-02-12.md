# 作業ログ 2026-02-12

## YouTube サムネイル 403 エラー対応
- `youtube_uploader.py` のサムネイル設定を try-except でグレースフル処理に変更
- 原因: YouTube アカウントの電話番号認証が未完了
- 対応: ユーザーが YouTube Studio で電話認証を実施、手動でサムネイル設定

## X (Twitter) 投稿の 403/401 エラー対応
- 原因: X Developer Portal のアプリ権限が Read のみだった
- 対応: Read and Write に変更 → API Key/Access Token を全再生成 → .env 更新
- 投稿成功を確認

## Gemini 読みアノテーション自動挿入の廃止
- `script_generator.py` のプロンプトから読みアノテーション指示を削除
- 今後は手動（script.json 編集 + reading_dict.txt）のみで対応

## YouTube 概要欄の改善
- `upload.py` に `_extract_intro()` を追加
- タイトル流用 → note_content の H1 直下段落 + ハッシュタグに変更

## YouTube ショート動画アップロード機能
- `src/upload_shorts.py` を新規作成
- `upload_info.json` から本編 URL を取得し、概要欄に本編リンク・タグ・チャンネルURLを記載
- タイトルの `\n` を YouTube アップロード時に除去

## テロップ改行制御
- `text_renderer.py` の `_wrap_text_by_width()` が `\n` を明示的改行として処理するよう改修
- script.json のセリフに `\n` を入れることで、句読点での改行が可能に

## 毎日の記念日メール送信機能
- `scripts/daily_kinenbi.py` を新規作成
  - Wikipedia 日本語版から「記念日・年中行事」セクションを取得
  - SendGrid API でメール送信
  - `--dry-run` / `--date` オプション対応
- `.github/workflows/daily_kinenbi.yml` を作成
  - 毎日 0:15 JST (cron: `15 15 * * *`) に自動実行
  - `workflow_dispatch` で手動実行も可能
- SendGrid アカウント設定、Sender 認証、API Key 発行を実施
- GitHub Secrets に `SENDGRID_API_KEY`, `EMAIL_TO`, `EMAIL_FROM` を登録
- ローカル送信テスト成功（2月12日の記念日 7件）

## エンディング画面の実装
- `_create_ending_clip()` を `video_composer.py` に追加（横長・縦長両対応）
- 構成: チャンネル登録誘導テキスト → 撤収雑談ボイス（字幕なし） → キャラのみフェードアウト
- キャラのみフェードアウトし、テキスト・ロゴは最後まで表示
  - `_char_opacity()`: フェードイン+フェードアウト（キャラ用）
  - `_static_opacity()`: フェードインのみ（ロゴ・テキスト用）
- 横長: キャラふわふわ浮遊（本編と同様）
- 縦長: キャラ半分サイズでブロック崩しのボールのように跳ね回る（`_bounce()` 関数）
- `scripts/generate_ending_voice.py` 新規作成（COEIROINK でボイス4種生成）
- `config.py` に ED 設定（ボイスパス、フェードイン/アウト秒数、セリフ間隔等）を追加
- EDボイスが存在しない場合はグレースフルスキップ

## Shorts アップロード修正
- `upload_shorts.py`: タイトルに `#Shorts` タグを自動付与（API 経由で Shorts として認識させるため）

## shorts_skip によるセリフ省略機能
- `DialogueLine` に `shorts_skip: bool` フィールドを追加
- `script_generator.py`: Gemini プロンプトに `shorts_skip` タグ付けの指示を追加（脱線・補足・相槌が対象、全体の20-30%）
- `compose_portrait()`: 推定尺が 3 分を超える場合のみ `shorts_skip=true` のセリフを除外
- 倍速（`with_speed_scaled()`）はフォールバックとして残存（ピッチ上昇するため非推奨）
