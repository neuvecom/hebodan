# 作業ログ 2026-02-14

## Shorts チャットアイコンサイズ拡大
- `video_composer.py`: `_CHAT_ICON_SIZE` を 80px → 100px に変更
- 理由: 80px では表情（normal/angry/surprised 等）の違いが判別しにくい
- コード上は表情ごとに異なるアイコンを正しく選択していたが、サイズが小さく視認性が低かった

## CLI 再開メッセージの Python パス修正
- `cli.py`: 中断時の再開コマンド表示を `python -m src run` → `sys.executable` に変更
- 修正箇所: 音声+動画生成前の中断（L193）、動画確認後の中断（L268）
- 原因: venv の Python で実行しても再開メッセージが `python -m src run` と表示され、システム Python で再実行すると `ModuleNotFoundError` が発生
- 対応後: `.venv/bin/python -m src run -s ...` のように実行中の Python パスが表示される

## reading_dict.txt 更新
- `881000<ハチ ハチ イチ ゼロ ゼロ ゼロ>` を追加（COEIROINK 数字読み対応）

## BGM機能追加
- `config.py`: BGM設定3つを追加
  - `BGM_PATH`: `assets/audio/bgm/Baby Animals Playing - Joel Cummins.mp3`
  - `BGM_VOLUME = 0.08`（会話の邪魔にならない8%音量）
  - `BGM_FADE_OUT = 3.0`（末尾3秒フェードアウト）
- `video_composer.py`: `_mix_bgm()` ヘルパー関数を追加
  - MoviePy `AudioLoop` で動画の長さに合わせてBGMをループ
  - `with_volume_scaled()` で低音量化、`AudioFadeOut` で末尾フェードアウト
  - `CompositeAudioClip` で既存の会話音声とミックス
  - BGMファイルがない場合はグレースフルスキップ
- OPにはBGMを流さず、本編開始（OP終了後=7秒目）からBGM再生
  - `bgm_start` 引数で開始位置を制御（OPなしの場合は0秒から）
- `compose_landscape` / `compose_portrait` の両方に対応

## 記念日メール SendGrid → Resend 移行
- 背景: SendGrid 経由のメールが迷惑メールに分類されてしまう問題
- `scripts/daily_kinenbi.py`: SendGrid API → Resend API に変更
  - エンドポイント: `https://api.resend.com/emails`
  - リクエスト形式を Resend 仕様に変更（`from`, `to`, `subject`, `html`）
  - 環境変数: `SENDGRID_API_KEY` → `RESEND_API_KEY`
- `.github/workflows/daily_kinenbi.yml`: シークレット名を `RESEND_API_KEY` に変更
- `.env`: `SENDGRID_API_KEY` → `RESEND_API_KEY`、`EMAIL_FROM` → `onboarding@resend.dev`（テスト用）
- ローカル送信テスト成功（2月14日の記念日 6件、neuvecom@gmail.com 宛）

## 読みアノテーション「〇」(U+3007) 対応
- `reading_annotations.py`: `_READING_PATTERN` / `_INLINE_PATTERN` に `〇` を追加
- 原因: 「〇」(U+3007) は CJK統合漢字 (`一-龯`) の範囲外（CJK Symbols ブロック）のためマッチせず
- `〇〇<まるまる>` のアノテーションが無視され、COEIROINKが「ゼロゼロ」と読んでいた
- `々ヶ` と同様に個別文字として文字クラスに追加して解決
